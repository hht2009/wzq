<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å­æ£‹å°æ¸¸æˆâ€”â€”é»„æ˜Šéœ†çš„åšå®¢</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #6a11cb, #2575fc);
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        #chess {
            display: block;
            margin: 20px auto;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .buttons button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #ff6f61;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
        }
        .buttons button.unable {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #resultTxt {
            margin-top: 20px;
            font-size: 20px;
            color: #fff;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <h1>äº”å­æ£‹æ¸¸æˆ</h1>
    <canvas id="chess" width="450" height="450"></canvas>
    <div class="buttons">
        <button id="goback">æ‚”æ£‹</button>
        <button id="return">æ’¤é”€æ‚”æ£‹</button>
        <button id="restart">é‡æ–°å¼€å§‹</button>
    </div>
    <div id="resultTxt">â€“ç›Šæ™ºäº”å­æ£‹â€“</div>

    <script>
        // èµ¢æ³•çš„ç»Ÿè®¡æ•°ç»„
        var myWin = [];
        var computerWin = [];

        // èµ¢æ³•æ•°ç»„
        var wins = [];
        for (var i = 0; i < 15; i++) {
            wins[i] = [];
            for (var j = 0; j < 15; j++) {
                wins[i][j] = [];
            }
        }

        var count = 0; // èµ¢æ³•æ€»æ•°

        // æ¨ªçº¿èµ¢æ³•
        for (var i = 0; i < 15; i++) {
            for (var j = 0; j < 11; j++) {
                for (var k = 0; k < 5; k++) {
                    wins[i][j + k][count] = true;
                }
                count++;
            }
        }

        // ç«–çº¿èµ¢æ³•
        for (var i = 0; i < 15; i++) {
            for (var j = 0; j < 11; j++) {
                for (var k = 0; k < 5; k++) {
                    wins[j + k][i][count] = true;
                }
                count++;
            }
        }

        // æ­£æ–œçº¿èµ¢æ³•
        for (var i = 0; i < 11; i++) {
            for (var j = 0; j < 11; j++) {
                for (var k = 0; k < 5; k++) {
                    wins[i + k][j + k][count] = true;
                }
                count++;
            }
        }

        // åæ–œçº¿èµ¢æ³•
        for (var i = 0; i < 11; i++) {
            for (var j = 14; j > 3; j--) {
                for (var k = 0; k < 5; k++) {
                    wins[i + k][j - k][count] = true;
                }
                count++;
            }
        }

        // åˆå§‹åŒ–èµ¢æ³•ç»Ÿè®¡æ•°ç»„
        for (var i = 0; i < count; i++) {
            myWin[i] = 0;
            computerWin[i] = 0;
        }

        var chess = document.getElementById("chess");
        var context = chess.getContext('2d');
        context.strokeStyle = '#bfbfbf'; // è¾¹æ¡†é¢œè‰²

        var backbtn = document.getElementById("goback");
        var returnbtn = document.getElementById("return");
        var resultTxt = document.getElementById("resultTxt");

        var over = false; // æ¸¸æˆæ˜¯å¦ç»“æŸ
        var me = true; // å½“å‰ç©å®¶ï¼ˆtrueä¸ºç©å®¶ï¼Œfalseä¸ºç”µè„‘ï¼‰
        var chressBord = []; // æ£‹ç›˜çŠ¶æ€
        for (var i = 0; i < 15; i++) {
            chressBord[i] = [];
            for (var j = 0; j < 15; j++) {
                chressBord[i][j] = 0;
            }
        }

        var _nowi, _nowj; // ç©å®¶æœ€åä¸€æ­¥çš„åæ ‡
        var _compi, _compj; // ç”µè„‘æœ€åä¸€æ­¥çš„åæ ‡
        var _myWin = []; // ç©å®¶èµ¢æ³•å¤‡ä»½
        var _compWin = []; // ç”µè„‘èµ¢æ³•å¤‡ä»½
        var backAble = false; // æ˜¯å¦å¯ä»¥æ‚”æ£‹
        var returnAble = false; // æ˜¯å¦å¯ä»¥æ’¤é”€æ‚”æ£‹

        // ç”»æ£‹ç›˜
        function drawChessBoard() {
            context.fillStyle = '#f0d9b5'; // æ£‹ç›˜èƒŒæ™¯è‰²
            context.fillRect(0, 0, 450, 450);

            for (var i = 0; i < 15; i++) {
                context.beginPath();
                context.moveTo(15 + i * 30, 15);
                context.lineTo(15 + i * 30, 435);
                context.closePath();
                context.stroke();

                context.beginPath();
                context.moveTo(15, 15 + i * 30);
                context.lineTo(435, 15 + i * 30);
                context.closePath();
                context.stroke();
            }
        }

        // ç”»æ£‹å­
        function oneStep(i, j, me) {
            context.beginPath();
            context.arc(15 + i * 30, 15 + j * 30, 13, 0, 2 * Math.PI);
            context.closePath();
            var gradient = context.createRadialGradient(15 + i * 30 + 2, 15 + j * 30 - 2, 13, 15 + i * 30 + 2, 15 + j * 30 - 2, 0);
            if (me) {
                gradient.addColorStop(0, '#0A0A0A');
                gradient.addColorStop(1, '#636766');
            } else {
                gradient.addColorStop(0, '#D1D1D1');
                gradient.addColorStop(1, '#F9F9F9');
            }
            context.fillStyle = gradient;
            context.fill();
        }

        // é”€æ¯æ£‹å­å¹¶æ¢å¤æ£‹ç›˜èƒŒæ™¯
        function minusStep(i, j) {
            // æ¸…é™¤æ£‹å­
            context.clearRect(i * 30, j * 30, 30, 30);

            // æ¢å¤æ£‹ç›˜èƒŒæ™¯
            context.fillStyle = '#f0d9b5'; // æ£‹ç›˜èƒŒæ™¯è‰²
            context.fillRect(i * 30, j * 30, 30, 30);

            // é‡æ–°ç»˜åˆ¶æ£‹ç›˜çº¿æ¡
            context.strokeStyle = '#bfbfbf'; // çº¿æ¡é¢œè‰²
            context.beginPath();
            context.moveTo(15 + i * 30, 15);
            context.lineTo(15 + i * 30, 435);
            context.moveTo(15, 15 + j * 30);
            context.lineTo(435, 15 + j * 30);
            context.stroke();
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = function () {
            drawChessBoard(); // ç”»æ£‹ç›˜
        };

        // é‡æ–°å¼€å§‹
        document.getElementById("restart").onclick = function () {
            window.location.reload();
        };

        // ç©å®¶ä¸‹æ£‹
        chess.onclick = function (e) {
            if (over) {
                return;
            }
            if (!me) {
                return;
            }

            // æ‚”æ£‹åŠŸèƒ½å¯ç”¨
            backbtn.className = backbtn.className.replace(new RegExp("(\\s|^)unable(\\s|$)"), " ");
            var x = e.offsetX;
            var y = e.offsetY;
            var i = Math.floor(x / 30);
            var j = Math.floor(y / 30);
            _nowi = i;
            _nowj = j;

            if (chressBord[i][j] == 0) {
                oneStep(i, j, me);
                chressBord[i][j] = 1; // ç©å®¶å æ®ä½ç½®

                // å¤‡ä»½èµ¢æ³•ç»Ÿè®¡æ•°ç»„
                _myWin = [...myWin];
                _compWin = [...computerWin];

                for (var k = 0; k < count; k++) {
                    if (wins[i][j][k]) {
                        myWin[k]++;
                        computerWin[k] = 6; // è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢äº†
                        if (myWin[k] == 5) {
                            resultTxt.innerHTML = 'ğŸ‰ æ­å–œï¼Œä½ èµ¢äº†ï¼';
                            over = true;
                        }
                    }
                }

                if (!over) {
                    me = !me;
                    backAble = true; // å…è®¸æ‚”æ£‹
                    computerAI();
                }
            }
        };

        // æ‚”æ£‹
        backbtn.onclick = function (e) {
            if (!backAble) {
                return;
            }
            over = false;
            me = true;

            // æ’¤é”€æ‚”æ£‹åŠŸèƒ½å¯ç”¨
            returnbtn.className = returnbtn.className.replace(new RegExp("(\\s|^)unable(\\s|$)"), " ");

            // ç©å®¶æ‚”æ£‹
            chressBord[_nowi][_nowj] = 0; // ç©å®¶å æ®ä½ç½®è¿˜åŸ
            minusStep(_nowi, _nowj); // é”€æ¯æ£‹å­å¹¶æ¢å¤èƒŒæ™¯

            // æ¢å¤èµ¢æ³•ç»Ÿè®¡æ•°ç»„
            myWin = [..._myWin];
            computerWin = [..._compWin];

            // ç”µè„‘ç›¸åº”çš„æ‚”æ£‹
            chressBord[_compi][_compj] = 0; // ç”µè„‘å æ®ä½ç½®è¿˜åŸ
            minusStep(_compi, _compj); // é”€æ¯æ£‹å­å¹¶æ¢å¤èƒŒæ™¯

            resultTxt.innerHTML = 'â€“ç›Šæ™ºäº”å­æ£‹â€“';
            returnAble = true;
            backAble = false;
        };

        // æ’¤é”€æ‚”æ£‹
        returnbtn.onclick = function (e) {
            if (!returnAble) {
                return;
            }

            // ç©å®¶æ’¤é”€æ‚”æ£‹
            chressBord[_nowi][_nowj] = 1; // ç©å®¶å æ®ä½ç½®
            oneStep(_nowi, _nowj, me);

            // æ¢å¤èµ¢æ³•ç»Ÿè®¡æ•°ç»„
            myWin = [..._myWin];
            computerWin = [..._compWin];

            for (var k = 0; k < count; k++) {
                if (wins[_nowi][_nowj][k]) {
                    myWin[k]++;
                    computerWin[k] = 6; // è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢
                }
                if (myWin[k] == 5) {
                    resultTxt.innerHTML = 'ğŸ‰ æ­å–œï¼Œä½ èµ¢äº†ï¼';
                    over = true;
                }
            }

            // ç”µè„‘æ’¤é”€ç›¸åº”çš„æ‚”æ£‹
            chressBord[_compi][_compj] = 2; // ç”µè„‘å æ®ä½ç½®
            oneStep(_compi, _compj, false);

            for (var k = 0; k < count; k++) {
                if (wins[_compi][_compj][k]) {
                    computerWin[k]++;
                    myWin[k] = 6; // è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢
                }
                if (computerWin[k] == 5) {
                    resultTxt.innerHTML = 'ğŸ˜¢ è®¡ç®—æœºèµ¢äº†ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼';
                    over = true;
                }
            }

            returnbtn.className += ' ' + 'unable';
            returnAble = false;
            backAble = true;
        };

        // ç”µè„‘ä¸‹æ£‹
        var computerAI = function () {
            var myScore = [];
            var computerScore = [];
            var max = 0;
            var u = 0, v = 0;

            for (var i = 0; i < 15; i++) {
                myScore[i] = [];
                computerScore[i] = [];
                for (var j = 0; j < 15; j++) {
                    myScore[i][j] = 0;
                    computerScore[i][j] = 0;
                }
            }

            for (var i = 0; i < 15; i++) {
                for (var j = 0; j < 15; j++) {
                    if (chressBord[i][j] == 0) {
                        for (var k = 0; k < count; k++) {
                            if (wins[i][j][k]) {
                                if (myWin[k] == 1) {
                                    myScore[i][j] += 200;
                                } else if (myWin[k] == 2) {
                                    myScore[i][j] += 400;
                                } else if (myWin[k] == 3) {
                                    myScore[i][j] += 2000;
                                } else if (myWin[k] == 4) {
                                    myScore[i][j] += 10000;
                                }

                                if (computerWin[k] == 1) {
                                    computerScore[i][j] += 220;
                                } else if (computerWin[k] == 2) {
                                    computerScore[i][j] += 420;
                                } else if (computerWin[k] == 3) {
                                    computerScore[i][j] += 2100;
                                } else if (computerWin[k] == 4) {
                                    computerScore[i][j] += 20000;
                                }
                            }
                        }

                        if (myScore[i][j] > max) {
                            max = myScore[i][j];
                            u = i;
                            v = j;
                        } else if (myScore[i][j] == max) {
                            if (computerScore[i][j] > computerScore[u][v]) {
                                u = i;
                                v = j;
                            }
                        }

                        if (computerScore[i][j] > max) {
                            max = computerScore[i][j];
                            u = i;
                            v = j;
                        } else if (computerScore[i][j] == max) {
                            if (myScore[i][j] > myScore[u][v]) {
                                u = i;
                                v = j;
                            }
                        }
                    }
                }
            }

            _compi = u;
            _compj = v;
            oneStep(u, v, false);
            chressBord[u][v] = 2; // ç”µè„‘å æ®ä½ç½®

            // å¤‡ä»½èµ¢æ³•ç»Ÿè®¡æ•°ç»„
            _myWin = [...myWin];
            _compWin = [...computerWin];

            for (var k = 0; k < count; k++) {
                if (wins[u][v][k]) {
                    computerWin[k]++;
                    myWin[k] = 6; // è¿™ä¸ªä½ç½®å¯¹æ–¹ä¸å¯èƒ½èµ¢äº†
                    if (computerWin[k] == 5) {
                        resultTxt.innerHTML = 'ğŸ˜¢ è®¡ç®—æœºèµ¢äº†ï¼Œç»§ç»­åŠ æ²¹å“¦ï¼';
                        over = true;
                    }
                }
            }

            if (!over) {
                me = !me;
            }
        };
    </script>
</body>
</html>